#!/usr/bin/env python3
from __future__ import annotations

import sys
import os
import asyncio

# Path fix for src/ import
project_root = os.path.abspath(os.path.join(os.path.dirname(__file__), "..", ".."))
sys.path.insert(0, os.path.join(project_root, "src"))

try:
    from wrapper.drivers.gemini_cli import GeminiCLIDriver
except ImportError:
    print("Gemini Driver not ready yet (ImportError). Waiting for Antigravity.", file=sys.stderr)
    sys.exit(1)

async def main() -> int:
    prompt = sys.stdin.read().strip()
    if not prompt:
        return 0
    
    driver = GeminiCLIDriver()
    try:
        await driver.start()
        async for chunk in driver.chat(prompt, stop_tokens=[]):
            print(chunk, end="", flush=True)
        return 0
    except Exception as e:
        print(str(e), file=sys.stderr)
        return 1
    finally:
        try:
            await driver.stop()
        except Exception:
            pass

if __name__ == "__main__":
    raise SystemExit(asyncio.run(main()))
